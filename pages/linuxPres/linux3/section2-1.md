## ユーザとグループの認識



## 目的：ユーザとグループの管理、権限設定の技能学習



### ユーザに関する

- `/etc/passwd` に管理している
- user:x:1000:1002:comment:/home/user:/bin/bash
  - `user`：アカウント名
  - `x`：パスワード位、実際の保持場所→`/etc/shadow`
  - `1000`：UID、ユーザを識別のID
    - rootユーザは必ず０、０〜９９は一般的にシステム管理アカウントで利用
    - 一般的に普通のユーザは１０００からスタート



  - `1002`：GID、ユーザのプライムグループを識別のID
  - `comment`：なんでもいい、メモ情報
  - `/home/user`：ホームディレクトリ
  - `/bin/bash`：ユーザがログインしたり新たにシェルを開いた際に起動されるシェルの絶対パス



### グループに関する

- `/etc/group`ファイルに管理している
  - 書式：`groupName:x:1002:groupMembers`
  - `x`：パスワード位、実際の保持場所→`/etc/gshadow`
    - 設定されたら、グループ外のユーザをこのグループへ切替（newgrp）の際にパスワードが必要



### コマンド

- `useradd [-c コメント][-d ホームディレクトリパス][-g GID][-u UID][-s シェルパス]`
  - GIDを指定しないと、自動的に同名のグループを作成（userdelも同じ）
- `usermod [オプション][-L ロック対象ユーザ][-U アンロック対象ユーザ]`
- `userdel [-r]`：`-r`はホームディレクトリも削除
- `passwd [-l][-u] ユーザ`：パスワード「ロック」「アンロック」「変更」



- `groupadd グループ名`
- `groupmod [-g 新GID][-n 新グループ名] グループ名`
- `groupdel グループ名`
- `gpasswd [-a][-d][-A] アカウント名 グループ名`：ユーザをグループに`[追加][削除][プライム指定]`



- `chage [-i] アカウント`：アカウントパラメータ表示や変更
- `id [-g][-G][-n][-r][-u]`：ユーザ情報表示`[プライムGID][所在GIDs][名前表示][実際ID][アカウントID]`
- `whoami`：現在アカウント名前を表示
- `groups アカウント名`：=`id -gn アカウント名`
- `newgrp グループ名`：指定グループをプライムへ一時切替、新たなbashプロセスが作成、終了まで維持



- 管理者権限を実行できるsudoersについて
  - `visudo`で`/etc/sudoers`から確認できる
- 管理権限でコマンドを実行について
  - `sudo コマンド`：コマンドの先頭にsudoを追加
- 他のユーザに切り替え
  - `su [user]`：指定ユーザ権限に切替え、省略の場合はroot
  - `su - [user]`：環境設定を含めて指定ユーザに切り替え



### 演習：

- 以下のアカウントを作成する
  - プライムグループ：toyosu
  - 所在グループ：tokyo
  - ユーザ名前：自分の名前
  - ホームディレクトリ：`/home/自分の名前`



## 権限について



- `ls -l`：コマンドでの実行結果にファイルの左側に`-rwxrwxrwx`の表現の説明
  - `[ファイルタイプ][所有者権限][グループ権限][その他ユーザ権限]`
  - 先頭１桁：`-、l、d`の三種類
    - `-`：普通のファイル
    - `l`：ソフトリンク（シンポンリンク）
    - `d`：ディレクトリ
    - `b or c`：IO設備（byteとcharacter）



- `rwx`に関する説明
  - `r`：読込可能：数値４（二進制：100）で表す
  - `w`：書込可能：数値２（二進制：010）で表す
  - `x`：実行可能：数値１（二進制：001）で表す
    - ディレクトリの場合はパスに入るは可能
- 質問：`drwxr--r--`の権限は？
- 質問：`-rwxr-xr--`の権限は？



- `rwx`の数値表記：それぞれの代表の数値の合算で表示
  - 例：`rw-`の数値表示は`6`
  - 例：`r-x`の数値表示は`5`
  - 例：`---`の数値表示は`0`
- 質問：`rwxr--r--`の数値表現は？
- 質問：ファイルの`664`の意味は？



## 演習：所有者と所在グループのみから実行可能  
所有者のみが編集可能、全てのユーザが読込可能なシェルファイルを作成



### その他

- `rwsrwsrwt`の設定について
  - `t`：作ったユーザのみ削除可能
    - 利用例：`/tmp`
  - `s`：実行する際に、s所在ユーザ／グループで実行
    - 利用例：`/bin/passwd`
- `umask`：該当ユーザのデフォルト権限を設定